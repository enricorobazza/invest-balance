{% extends '../main.html' %}
{% load static %}
{% block content %}

{% load guiabolso_tags %}

{% csrf_token %} 

<div class="row m-3">
  <div class="col-12">
    <div class="d-inline float-left">
      <ul class="nav nav-pills">
        <li class="nav-item border border-{% if not variable %}white{% else %}primary{% endif %} rounded">
          <a class="nav-link {% if not variable %}active{% endif %}" id="all" href="#">Todos</a>
        </li>
        <li class="nav-item border border-{% if variable %}white{% else %}primary{% endif %} rounded">
          <a class="nav-link {% if variable %}active{% endif %}" id="variable" href="#">Variáveis</a>
        </li>
      </ul>
    </div>
    <div class="d-inline float-left ml-2">
      <a id="minus" class="btn rounded-circle text-dark bg-light"><i class="fa fa-lg fa-arrow-left"></i></a>
      <a id="plus" class="btn rounded-circle text-dark bg-light"><i class="fa fa-lg fa-arrow-right"></i></a>
    </div>
    <div class="d-inline float-left ml-3">
      <input type="text" id="startdate" class="datepicker" />
    </div>
    <div class="d-inline float-left ml-1">
      <input type="text" id="enddate" class="datepicker" />
    </div>
    <div id="filterCategory" class="d-inline float-left ml-1 pt-2">
      
    </div>
    <div class="d-inline float-right">
      {{last_updated|date:'d/m/Y'}} {{last_updated|time:'H:i'}}
      <a class="btn btn-secondary ml-2" id="refresh" href="#">
        <i class="fa fa-sync mr-1"></i>
        Atualizar
      </a>
    </div>
  </div>
</div>

<div class="row m-3">
  <div id="accordion" class="col-12">
    <div class="card">
      <div class="card-header" id="headingOne">
        <h5 class="mb-0">
          <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
            Categorias
          </button>
        </h5>
      </div>
  
      <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
        <div class="card-body">
          <div class="table-responsive">
            <table id="categories" class="table my-2 table-striped">
              <thead class="thead-dark">
                <tr>
                  <th scope="col">Categoria</th>
                  <th scope="col">Valor (R$)</th>
                </tr>
              </thead>
              <tbody>
                {% if categories %}
                {% for category in categories %}
                <tr>
                  <td key="category_name" class="d-none">{{category.category__name}}</td>
                  <td key="category" class="align-middle">
                    <div style="
                      background-color:#{{category.category__color}};
                      color:#{{category.category__color|text_color}};
                      cursor: pointer;
                    " class="m-2 p-2 rounded d-inline">{{category.category__symbol|symbol}} {{category.category__name}}</div>
                  </td>
                  <td key="value" class="align-middle {% if category.value > 0 %} text-success {% else %} text-danger {% endif %}">{{category.value|stringformat:".2f"}}</td>
                </tr>

                {% endfor %}
                {% endif %}

                <tr class="bg-dark text-white">
                  <td class="align-middle pl-4">Total</td>
                  <td key="value" class="align-middle">{{total|stringformat:".2f"}}</td>
                </td>

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header" id="headingTwo">
        <h5 class="mb-0">
          <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            Transações
          </button>
        </h5>
      </div>
      <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
        <div class="card-body">
          <div class="table-responsive">
            <table id="transactions" class="table my-2 table-striped">
              <thead class="thead-dark">
                <tr>
                  <th scope="col">Ignorar</th>
                  <th scope="col">Categoria</th>
                  <th scope="col">Data</th>
                  <th scope="col">Descrição</th>
                  <th scope="col">Valor (R$)</th>
                </tr>
              </thead>
              <tbody>
                {% if transactions %}
                {% for transaction in transactions %}
                <tr {% if transaction.is_ignored %}
                    style="opacity: 0.1"
                    {% endif %}
                >
                  <td key="code" class="d-none">{{transaction.code}}</td>
                  <td key="is_ignored" class="align-middle">
                    <div class="form-check">
                      <input class="form-check-input ignore-input" type="checkbox" value="" 
                      {% if transaction.is_ignored %} checked {% endif %}
                      >
                      <label class="form-check-label">
                        Ignorar
                      </label>
                    </div>
                  </td>
                  <td key="category_name" class="d-none">
                      {{transaction.category.name}}
                  </td>
                  <td key="category" class="align-middle">
                    <div style="
                      background-color:#{{transaction.category.color}};
                      color:#{{transaction.category.color|text_color}};
                    " class="m-2 p-2 rounded d-inline">{{transaction.category.symbol|symbol}} {{transaction.category.name}}</div>
                  </td>
                  <td key="date" class="align-middle">{{transaction.date|date:'d/m/Y'}}</td>
                  <td key="text" class="align-middle">{{transaction.text}}</td>
                  <td key="value" class="align-middle {% if transaction.value > 0 %} text-success {% else %} text-danger {% endif %}">{{transaction.value}}</td>
                </tr>

                {% endfor %}
                {% endif %}

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  var baseUrl = "{% url 'list_guiabolso' %}?";
  var refreshUrl = "{% url 'refresh_guiabolso' %}?";

  var startDate, endDate

  {% if startdate %}
    startDate = "{{startdate|date:'d/m/Y'}}"
  {% endif %}

  {% if enddate %}
    endDate = "{{enddate|date:'d/m/Y'}}"
  {% endif %}

</script>

<script src="{% static '/js/guiabolso.js' %}"></script>


{% endblock %}